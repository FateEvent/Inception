# sources:
#   https://www.digitalocean.com/community/tutorials/php-fpm-nginx
#   https://medium.com/@mvuksano/how-to-properly-configure-your-nginx-for-tls-564651438fe0

server {
	# Enable TLS and HTTP2
	listen		443 ssl;
	server_name	localhost faventur.42.fr;

	root		/var/www/html;

	access_log	/var/log/nginx/access.log;
	error_log	/var/log/nginx/error.log error;
	index		index.html index.htm index.php;

	# Use only TLS
	ssl_protocols		TLSv1.2 TLSv1.3;
	ssl_certificate		/etc/nginx/ssl/inception.crt;
	ssl_certificate_key	/etc/nginx/ssl/inception.key;

	location / {
		autoindex	on;
		# First attempt to serve request as file then as a directory,
		# before falling back to displaying a 404 page:
		# https://stackoverflow.com/questions/57561236/how-nginx-process-404-fallback-in-try-files
		try_files	$uri $uri/ =404;
  }

	location ~ \.php$ {
		fastcgi_split_path_info	^(.+\.php)(/.+)$;
		fastcgi_pass			wordpress:9000;
		fastcgi_index			index.php;
		include					fastcgi_params;

		fastcgi_param 			SCRIPT_FILENAME $document_root$fastcgi_script_name;
		fastcgi_param			SCRIPT_NAME $fastcgi_script_name;
		fastcgi_param			PATH_INFO $fastcgi_path_info;
	}
}
